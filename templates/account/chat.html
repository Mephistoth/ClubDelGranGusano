{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Chat</title>
    <link rel="stylesheet" href="{% static 'css/chat.css' %}">
</head>
<body>
    <div class="chat-container">
        <div class="chat-messages" id="chat-messages"></div>
        <form class="chat-input" id="chat-form">
            <input type="text" id="message-input" autocomplete="off" placeholder="Escribe un mensaje..." required>
            <button type="submit">Enviar</button>
        </form>
    </div>
    // Aqui ira el script de javascript para el chat
    <script>
        const chatSocket = new WebSocket(
        'ws://' + window.location.host + '/ws/chat/'
    );

    const chatMessages = document.getElementById('chat-messages');
    const chatForm = document.getElementById('chat-form');
    const messageInput = document.getElementById('message-input');

    // Recibir mensajes del WebSocket
    chatSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        const message = data.message;
        const username = data.username;

        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message');

        // Si el mensaje es del usuario actual
        if (username === "{{ request.user.username }}") {
            messageDiv.classList.add('user');
        } else {
            messageDiv.classList.add('other');
        }

        messageDiv.textContent = username + ': ' + message;
        chatMessages.appendChild(messageDiv);

        // Auto scroll hacia abajo
        chatMessages.scrollTop = chatMessages.scrollHeight;
    };

    // Cuando se cierra la conexi√≥n
    chatSocket.onclose = function(e) {
        console.error('Chat socket cerrado inesperadamente');
    };

    // Enviar mensajes
    chatForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const message = messageInput.value.trim();
        if (message) {
            chatSocket.send(JSON.stringify({
                'message': message
            }));
            messageInput.value = '';
        }
    });
    </script>
</body>
</html>