{% extends 'base.html' %}
{% load custom_tags %}
{% block content %}

<!-- Botón para volver -->
<a href="{% url 'lista_blogs' %}" class="btn btn-primary mt-3">Volver a la lista</a>
<hr>

{% if user.is_staff or user|has_group:"educador" %}
  <form method="POST" action="{% url 'eliminar_blog' blog.id %}" onsubmit="return confirm('¿Estás seguro de eliminar esta publicación?');">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger mt-3">Eliminar publicación</button>
  </form>
{% endif %}


<!-- Tarjeta del blog -->
<div class="card mt-4 p-4 shadow-sm">
  <h2 class="mb-3">{{ blog.titulo }}</h2>
  <p class="text-muted">Publicado por {{ blog.autor.username }} el {{ blog.fecha_creacion|date:"d/m/Y H:i" }}</p>
  <div class="mb-3">{{ blog.contenido|safe }}</div>

  <!-- Imagen del blog -->
  {% if blog.imagen %}
    <img src="{{ blog.imagen.url }}" alt="Imagen del blog: {{ blog.titulo }}" class="img-fluid rounded mb-3" style="max-width: 100%; height: auto;">
  {% endif %}

  <!-- Video del blog -->
  {% if blog.video_url %}
    <div class="mb-3">
      <a href="{{ blog.video_url }}" target="_blank" class="btn btn-outline-secondary">Ver Video</a>
    </div>
  {% endif %}
</div>

<hr>
<h3>Comentarios</h3>

<!-- Mostrar comentarios recursivos -->
{% if comentarios %}
  {% include "blogs/comentario_tree.html" with comentarios=comentarios nivel=0 %}
{% else %}
  <p class="text-muted">No hay comentarios aún.</p>
{% endif %}

<!-- Formulario para agregar un nuevo comentario -->
<hr>
<h3>Agregar comentario</h3>
<form method="POST" class="mt-3">
  {% csrf_token %}
  {% if form.errors %}
    <div class="alert alert-danger">
      Por favor corrige los errores.
    </div>
  {% endif %}
  {{ form.as_p }}
  <button type="submit" class="btn btn-success">Comentar</button>
  <hr>
</form>

<!-- Script para mostrar formulario de respuesta -->
<script>
function mostrarRespuesta(id) {
  const form = document.getElementById('respuesta-form-' + id);
  if (form) form.style.display = 'block';
}
</script>

{% endblock %}