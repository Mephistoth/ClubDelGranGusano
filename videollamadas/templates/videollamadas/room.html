{% extends 'base.html' %}

{% block content %}
  <h2>Sala de videollamada: {{ sala.codigo }}</h2>

  <div id="jitsi-container" style="width: 100%; height: 600px;"></div>

  <p><a href="{% url 'videollamadas:lista_salas' %}">Volver a la lista de salas</a></p>
{% endblock %}

{% block extra_js %}
  <script src="https://8x8.vc/{{ JAAS_TENANT }}/external_api.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const domain = '8x8.vc/{{ JAAS_TENANT }}';
    const roomName = '{{ sala.codigo }}';
    const container = document.querySelector('#jitsi-container');

    const options = {
      roomName,
      width: '100%',
      height: '100%',
      parentNode: container,
      jwt: '{{ token }}',
      configOverwrite: {
        prejoinPageEnabled: false,
        disableDeepLinking: true
      },
      interfaceConfigOverwrite: {
        LANG: 'es',
        TOOLBAR_BUTTONS: [
          'microphone', 'camera', 'desktop', 'hangup',
          'chat', 'tileview'
        ]
      }
    };

    try {
      const api = new JitsiMeetExternalAPI(domain, options);
      api.executeCommand('displayName', '{{ user.username }}');
    } catch (e) {
      console.error('No se pudo cargar JitsiMeetExternalAPI:', e);
    }
  });
</script>
{% endblock %}