{% extends 'base.html' %}
{% load static %}

{% block content %}
  <style>
    /* Estilos del popup */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .popup-box {
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .popup-buttons {
      margin-top: 20px;
      display: flex;
      justify-content: space-around;
    }

    .popup-buttons button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    .popup-buttons .confirm {
      background-color: #d9534f;
      color: white;
    }

    .popup-buttons .cancel {
      background-color: #6c757d;
      color: white;
    }
  </style>

  <h2>Salas públicas disponibles</h2>

  {% if messages %}
    {% for msg in messages %}
      <div class="alert">{{ msg }}</div>
    {% endfor %}
  {% endif %}

  {% if salas %}
    <ul>
      {% for sala in salas %}
        <li>
          <strong>{{ sala.nombre }}</strong> (código: <em>{{ sala.codigo }}</em>) – 
          creada por {{ sala.creador.username }} el {{ sala.fecha_creacion|date:"d/m/Y H:i" }}
          – <a href="{% url 'videollamadas:room' sala.codigo %}">Unirse</a>
          {% if sala.creador == user %}
            – <em>(tú eres el anfitrión)</em>
            – <a href="#" style="color: red;" onclick="abrirPopup('{{ sala.codigo }}'); return false;">Eliminar</a>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No hay salas públicas disponibles.</p>
  {% endif %}

  <p><a href="{% url 'videollamadas:menu' %}">Volver al menú</a></p>

  <!-- Popup de confirmación -->
  <div class="popup-overlay" id="popup-confirm">
    <div class="popup-box">
      <p>¿Estás seguro de que deseas eliminar esta sala?</p>
      <div class="popup-buttons">
        <form id="form-eliminar" method="post">
          {% csrf_token %}
          <button type="submit" class="confirm">Aceptar</button>
        </form>
        <button class="cancel" onclick="cerrarPopup()">Cancelar</button>
      </div>
    </div>
  </div>

  <script>
    function abrirPopup(codigoSala) {
      const form = document.getElementById('form-eliminar');
      form.action = `/videollamadas/eliminar/${codigoSala}/`;
      document.getElementById('popup-confirm').style.display = 'flex';
    }

    function cerrarPopup() {
      document.getElementById('popup-confirm').style.display = 'none';
    }
  </script>
{% endblock %}
